<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Nube de Palabras Estables (FRENZY)</title>
    <style>
        body { 
            margin: 0; 
            padding: 20px; 
            background-color: #f0f0f0; 
            display: flex; /* Usamos Flexbox para centrar todo */
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            font-family: sans-serif; 
        }
        #wordcloudContainer { 
            text-align: center; 
            
            /* 🔥 CORRECCIÓN CLAVE: Esto fuerza a las palabras a agruparse */
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            /* Se establece un ancho máximo para que se vea como una nube */
            max-width: 80%; 
        }
        .word { 
            display: inline-block; 
            padding: 3px 6px; /* Reducir padding */
            margin: 3px; /* 🆕 OPTIMIZACIÓN: Reducir el margen para que las palabras se junten */
            border-radius: 5px;
            transition: font-size 0.5s;
            line-height: 1.1; /* Reducir aún más el espacio vertical */
        }
    </style>
</head>
<body>
    <div id="wordcloudContainer">
        <p>Cargando datos...</p>
    </div>

    <script>
        // 🚨 REEMPLAZAR con la URL que copió. Debe terminar en /exec
        const DATA_API_URL = 'https://script.google.com/macros/s/AKfycbzTgrB0UIG6dS0ivueA_ZK55rDzBrSXSVPiR-MqemHmieBLZQXLsF-B22PnR123SOCm/exec'; 

        // Definir un rango de colores simples
        const colors = ['#007bff', '#28a745', '#dc3545', '#ffc107', '#6f42c1'];

        function fetchAndDrawCloud() {
            fetch(DATA_API_URL)
                .then(response => response.json())
                .then(list => drawWordCloud(list))
                .catch(error => {
                    console.error('Error al obtener datos:', error);
                    document.getElementById('wordcloudContainer').innerHTML = "<p style='color:red;'>Error al cargar la nube.</p>";
                });
        }

        function drawWordCloud(list) {
            const container = document.getElementById('wordcloudContainer');
            if (!container || !list || list.length === 0) {
                container.innerHTML = "<p>Aún no hay suficientes palabras.</p>";
                return;
            }

            // Encontrar el factor de escalado para el tamaño de fuente
            const maxCount = list.reduce((max, [word, count]) => Math.max(max, count), 0);
            const minFontSize = 20; // Tamaño base para la palabra menos frecuente
            const maxFontSize = 100; // Tamaño máximo
            const range = maxFontSize - minFontSize;

            let htmlContent = '';
            
            list.forEach(([word, count], index) => {
                // Calcular el tamaño de fuente usando una escala logarítmica para mejor distribución visual
                const fontSize = minFontSize + (count / maxCount) * range;
                
                // Asignar color rotativo
                const color = colors[index % colors.length];

                htmlContent += `<span class="word" style="font-size: ${fontSize}px; color: ${color};">${word}</span>`;
            });

            // 🆕 OPTIMIZACIÓN DE CÁLCULO DE FUENTE: Usa logaritmo
            const maxCount = list.reduce((max, [word, count]) => Math.max(max, count), 0);
            
            // Usamos un factor de escalado logarítmico para que las frecuencias bajas se vean mejor
            const logMax = Math.log(maxCount + 1); 
            const minFontSize = 20; 
            const maxFontSize = 100; 
            const range = maxFontSize - minFontSize;

            let htmlContent = '';
            
            list.forEach(([word, count], index) => {
                // Cálculo Logarítmico: Mejor distribución del tamaño en el centro de la nube
                const fontSize = minFontSize + (Math.log(count + 1) / logMax) * range;
                
                // ... (código para asignar color y crear htmlContent queda igual) ...
                
                // Asignar color rotativo
                const color = colors[index % colors.length];

                htmlContent += `<span class="word" style="font-size: ${fontSize}px; color: ${color};">${word}</span>`;
            });

            container.innerHTML = htmlContent;
        }
        }

        window.onload = function() {
            fetchAndDrawCloud(); // Llamada inicial
            setInterval(fetchAndDrawCloud, 5000); // Pasamos a 5s por equilibrio seguridad - respuesta
        };
    </script>
</body>
</html>





